<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ders Çalışma Takip Uygulaması</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: #333;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .container {
            width: 100%;
            max-width: 500px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            overflow: hidden;
            margin-bottom: 20px;
        }
        
        header {
            background: #4e54c8;
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
        }
        
        h1 {
            font-size: 1.5rem;
            margin-bottom: 5px;
        }
        
        .date-display {
            font-size: 1.1rem;
            margin: 10px 0;
            font-weight: 500;
        }
        
        .auth-container {
            padding: 15px;
            background: #f8f9fa;
            text-align: center;
        }
        
        .auth-btn {
            padding: 12px 20px;
            border-radius: 50px;
            border: none;
            font-weight: 500;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            background: #4e54c8;
            color: white;
            margin: 5px;
        }
        
        .auth-btn:hover {
            background: #3f44a7;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 10px;
            background: #f8f9fa;
        }
        
        .user-email {
            margin-right: 10px;
            font-weight: 500;
        }
        
        .stats {
            display: flex;
            justify-content: space-around;
            padding: 15px;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
        }
        
        .stat-box {
            text-align: center;
            padding: 10px;
        }
        
        .stat-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: #4e54c8;
        }
        
        .stat-label {
            font-size: 0.8rem;
            color: #6c757d;
        }
        
        .subject-list {
            padding: 20px;
        }
        
        .subject-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid #e9ecef;
        }
        
        .subject-name {
            font-weight: 500;
            display: flex;
            align-items: center;
        }
        
        .subject-name i {
            margin-right: 10px;
            color: #4e54c8;
        }
        
        .subject-input {
            width: 80px;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 10px;
            text-align: center;
            font-size: 1rem;
            transition: border-color 0.3s;
        }
        
        .subject-input:focus {
            border-color: #4e54c8;
            outline: none;
        }
        
        .reading-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            margin: 0 20px 20px;
        }
        
        .reading-title {
            font-weight: 500;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }
        
        .reading-title i {
            margin-right: 10px;
            color: #4e54c8;
        }
        
        .reading-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 15px;
            text-align: center;
            font-size: 1.2rem;
            transition: border-color 0.3s;
        }
        
        .reading-input:focus {
            border-color: #4e54c8;
            outline: none;
        }
        
        .buttons {
            display: flex;
            justify-content: space-between;
            padding: 0 20px 20px;
        }
        
        .btn {
            padding: 15px 25px;
            border-radius: 15px;
            border: none;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: #4e54c8;
            color: white;
            flex: 1;
            margin-right: 10px;
        }
        
        .btn-primary:hover {
            background: #3f44a7;
        }
        
        .btn-secondary {
            background: #f0f2f5;
            color: #333;
            width: 55px;
        }
        
        .btn-secondary:hover {
            background: #e0e3e9;
        }
        
        .history-container {
            padding: 20px;
        }
        
        .history-title {
            font-size: 1.2rem;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #4e54c8;
            display: flex;
            align-items: center;
        }
        
        .history-title i {
            margin-right: 10px;
        }
        
        .history-item {
            padding: 15px;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
        }
        
        .history-date {
            font-weight: 500;
        }
        
        .history-stats {
            color: #6c757d;
            font-size: 0.9rem;
        }
        
        .motivation {
            text-align: center;
            color: white;
            margin-top: 20px;
            font-size: 1rem;
            max-width: 500px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
            padding: 0 10px;
        }
        
        .empty-state {
            text-align: center;
            padding: 30px;
            color: #6c757d;
        }
        
        .empty-state i {
            font-size: 3rem;
            margin-bottom: 15px;
            color: #ced4da;
        }
        
        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
        }
        
        .tab {
            flex: 1;
            text-align: center;
            padding: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            color: #6c757d;
        }
        
        .tab.active {
            color: #4e54c8;
            border-bottom: 3px solid #4e54c8;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            color: #6c757d;
        }
        
        .loading i {
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .modal-content {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            width: 90%;
            max-width: 400px;
        }
        
        .modal-input {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
        }
        
        .modal-buttons {
            display: flex;
            justify-content: flex-end;
            margin-top: 15px;
        }
        
        .modal-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin-left: 10px;
        }
        
        .modal-btn-primary {
            background-color: #4e54c8;
            color: white;
        }
        
        .modal-btn-secondary {
            background-color: #f0f2f5;
            color: #333;
        }
        
        .form-error {
            display: none;
            margin-top: 8px;
            padding: 10px 12px;
            border-radius: 8px;
            background-color: #fde8e8;
            color: #b71c1c;
            border: 1px solid #f5c2c7;
            font-size: 0.95rem;
        }
        
        .input-error {
            border-color: #dc2626 !important;
            background-color: #fff7f7;
        }
        
        .role-selection {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 60vh;
            padding: 40px 20px;
            text-align: center;
        }
        
        .role-title {
            font-size: 1.8rem;
            font-weight: 600;
            margin-bottom: 30px;
            color: #4e54c8;
        }
        
        .role-options {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .role-option {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 25px;
            border: 2px solid #e5e7eb;
            border-radius: 15px;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
            min-width: 140px;
        }
        
        .role-option:hover {
            border-color: #4e54c8;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(78, 84, 200, 0.15);
        }
        
        .role-option.selected {
            border-color: #4e54c8;
            background: #f8f9ff;
        }
        
        .role-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
            color: #4e54c8;
        }
        
        .role-name {
            font-weight: 600;
            font-size: 1.1rem;
            margin-bottom: 8px;
        }
        
        .role-desc {
            font-size: 0.9rem;
            color: #6c757d;
            line-height: 1.4;
        }
        
        .role-continue {
            padding: 12px 30px;
            background: #4e54c8;
            color: white;
            border: none;
            border-radius: 25px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .role-continue:hover {
            background: #3f44a7;
        }
        
        .role-continue:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .role-switch {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid #e5e7eb;
            border-radius: 20px;
            padding: 8px 15px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .role-switch:hover {
            background: white;
            border-color: #4e54c8;
        }
        
        /* Öğretmen paneli stilleri */
        .teacher-dashboard {
            padding: 20px;
        }
        
        .student-list {
            margin-top: 20px;
        }
        
        .student-item {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .student-item:hover {
            background: #e9ecef;
            transform: translateY(-2px);
        }
        
        .student-name {
            font-weight: 500;
            margin-bottom: 5px;
        }
        
        .student-stats {
            display: flex;
            justify-content: space-between;
            color: #6c757d;
            font-size: 0.9rem;
        }
        
        .student-detail {
            margin-top: 15px;
            padding: 15px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .detail-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #dee2e6;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .stat-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }
        
        .date-filter {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .filter-input {
            padding: 8px 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 0.9rem;
        }
        
        /* Rol seçiminde giriş formu stilleri */
        .role-auth-container {
            width: 100%;
            max-width: 400px;
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 15px;
            display: none;
        }
        
        .role-auth-title {
            text-align: center;
            margin-bottom: 20px;
            color: #4e54c8;
            font-weight: 600;
        }
        
        .role-auth-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .role-auth-input {
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }
        
        .role-auth-input:focus {
            border-color: #4e54c8;
            outline: none;
        }
        
        .role-auth-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 10px;
        }
        
        .role-auth-btn {
            padding: 12px 20px;
            border-radius: 10px;
            border: none;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .role-auth-primary {
            background: #4e54c8;
            color: white;
        }
        
        .role-auth-primary:hover {
            background: #3f44a7;
        }
        
        .role-auth-secondary {
            background: #f0f2f5;
            color: #333;
        }
        
        .role-auth-secondary:hover {
            background: #e0e3e9;
        }
        
        .teacher-actions {
            display: flex;
            gap: 10px;
            margin: 15px 0;
            justify-content: center;
        }
        
        .teacher-action-btn {
            padding: 10px 15px;
            border-radius: 10px;
            border: none;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: all 0.3s;
            background: #4e54c8;
            color: white;
        }
        
        .teacher-action-btn:hover {
            background: #3f44a7;
        }
        
        .student-details-panel {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        
        .performance-chart {
            height: 200px;
            background: #e9ecef;
            border-radius: 10px;
            margin: 15px 0;
            display: flex;
            align-items: flex-end;
            justify-content: space-around;
            padding: 10px;
        }
        
        .chart-bar {
            width: 40px;
            background: #4e54c8;
            border-radius: 5px 5px 0 0;
            position: relative;
        }
        
        .chart-bar-label {
            position: absolute;
            bottom: -25px;
            left: 0;
            right: 0;
            text-align: center;
            font-size: 0.8rem;
        }
        
        .chart-bar-value {
            position: absolute;
            top: -20px;
            left: 0;
            right: 0;
            text-align: center;
            font-weight: bold;
        }
        
        @media (max-width: 500px) {
            .subject-item {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .subject-input {
                width: 100%;
                margin-top: 10px;
            }
            
            .buttons {
                flex-direction: column;
            }
            
            .btn-primary {
                margin-right: 0;
                margin-bottom: 10px;
            }
            
            .role-options {
                flex-direction: column;
            }
            
            .date-filter {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .role-auth-buttons {
                flex-direction: column;
            }
            
            .teacher-actions {
                flex-direction: column;
            }
        }
        
        /* Toast bildirimleri */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 2000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .toast {
            min-width: 260px;
            max-width: 360px;
            padding: 12px 14px;
            border-radius: 10px;
            color: #1f2937;
            background: #fff;
            border: 1px solid #e5e7eb;
            box-shadow: 0 8px 24px rgba(0,0,0,0.12);
            display: flex;
            align-items: center;
            gap: 10px;
            transform: translateY(-10px);
            opacity: 0;
            transition: all 0.25s ease-in-out;
        }
        
        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }
        
        .toast-success { border-left: 5px solid #16a34a; }
        .toast-error   { border-left: 5px solid #dc2626; }
        .toast-warning { border-left: 5px solid #f59e0b; }
        .toast-info    { border-left: 5px solid #3b82f6; }
        
        .toast-icon { font-size: 1.1rem; }
        .toast-text { font-weight: 500; }
    </style>
    
    <!-- Firebase App ve Authentication SDK'ları -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
</head>
<body>
    <div class="container">
        <div id="role-selection" class="role-selection">
            <div class="role-title">Hesap Türünü Seçin</div>
            <div class="role-options">
                <div class="role-option" onclick="selectRole('student')">
                    <i class="fas fa-user-graduate role-icon"></i>
                    <div class="role-name">Öğrenci</div>
                    <div class="role-desc">Ders çalışma verilerinizi takip edin</div>
                </div>
                <div class="role-option" onclick="selectRole('teacher')">
                    <i class="fas fa-chalkboard-teacher role-icon"></i>
                    <div class="role-name">Öğretmen</div>
                    <div class="role-desc">Öğrenci verilerini görüntüleyin</div>
                </div>
            </div>
            
            <div id="role-auth-container" class="role-auth-container">
                <h3 class="role-auth-title" id="role-auth-title">Öğrenci Girişi</h3>
                <div class="role-auth-form">
                    <input type="email" id="role-email" class="role-auth-input" placeholder="E-posta">
                    <input type="password" id="role-password" class="role-auth-input" placeholder="Şifre">
                    <div id="role-auth-error" class="form-error"></div>
                    <div class="role-auth-buttons">
                        <button class="role-auth-btn role-auth-secondary" onclick="showRoleSelectionOnly()">Geri Dön</button>
                        <button class="role-auth-btn role-auth-primary" onclick="roleLogin()">Giriş Yap</button>
                        <button class="role-auth-btn role-auth-primary" onclick="roleSignup()">Kayıt Ol</button>
                    </div>
                </div>
            </div>
            
            <button class="role-continue" id="continue-btn" onclick="showRoleAuth()" disabled>
                Devam Et
            </button>
        </div>

        <!-- Öğrenci Paneli -->
        <div id="student-panel" style="display: none;">
            <header>
                <h1>DERS TAKİP UYGULAMASI</h1>
                <div class="date-display" id="current-date">28 Ağustos 2023 Pazartesi</div>
            </header>
            
            <div class="role-switch" id="role-switch" onclick="showRoleSelection()">
                <i class="fas fa-user-graduate"></i> Öğrenci
            </div>
            
            <div class="user-info" style="display: none;">
                <span class="user-email" id="user-email">kullanici@example.com</span>
                <button class="auth-btn" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i> Çıkış
                </button>
            </div>
            
            <div class="tabs">
                <div class="tab active" onclick="showTab('today')">Bugün</div>
                <div class="tab" onclick="showTab('history')">Geçmiş</div>
            </div>
            
            <div class="tab-content active" id="today-tab">
                <div class="stats">
                    <div class="stat-box">
                        <div class="stat-value" id="total-questions">0</div>
                        <div class="stat-label">Çözülen Soru</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="total-pages">0</div>
                        <div class="stat-label">Okunan Sayfa</div>
                    </div>
                </div>
                
                <div class="subject-list">
                    <div class="subject-item">
                        <div class="subject-name"><i class="fas fa-language"></i> Türkçe</div>
                        <input type="number" min="0" class="subject-input" placeholder="0" id="turkce">
                    </div>
                    <div class="subject-item">
                        <div class="subject-name"><i class="fas fa-calculator"></i> Matematik</div>
                        <input type="number" min="0" class="subject-input" placeholder="0" id="matematik">
                    </div>
                    <div class="subject-item">
                        <div class="subject-name"><i class="fas fa-flask"></i> Fen Bilimleri</div>
                        <input type="number" min="0" class="subject-input" placeholder="0" id="fen">
                    </div>
                    <div class="subject-item">
                        <div class="subject-name"><i class="fas fa-landmark"></i> T.C. İnkılap Tarihi</div>
                        <input type="number" min="0" class="subject-input" placeholder="0" id="inkilap">
                    </div>
                    <div class="subject-item">
                        <div class="subject-name"><i class="fas fa-pray"></i> Din Kültürü</div>
                        <input type="number" min="0" class="subject-input" placeholder="0" id="din">
                    </div>
                    <div class="subject-item">
                        <div class="subject-name"><i class="fas fa-globe"></i> İngilizce</div>
                        <input type="number" min="0" class="subject-input" placeholder="0" id="ingilizce">
                    </div>
                </div>
                
                <div class="reading-section">
                    <div class="reading-title">
                        <i class="fas fa-book-open"></i> Okunan Sayfa Sayısı
                    </div>
                    <input type="number" min="0" class="reading-input" placeholder="0" id="sayfa">
                </div>
                
                <div class="buttons">
                    <button class="btn btn-primary" id="save-btn" onclick="saveDailyData()">
                        <i class="fas fa-save"></i> Günü Kaydet
                    </button>
                    <button class="btn btn-secondary" onclick="printData()">
                        <i class="fas fa-print"></i>
                    </button>
                </div>
            </div>
            
            <div class="tab-content" id="history-tab">
                <div class="history-container">
                    <div class="history-title">
                        <i class="fas fa-history"></i> Geçmiş Kayıtlar
                    </div>
                    <div id="history-list">
                        <div class="loading">
                            <i class="fas fa-spinner"></i> Yükleniyor...
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Öğretmen Paneli -->
        <div id="teacher-panel" class="teacher-dashboard" style="display: none;">
            <header>
                <h1>ÖĞRETMEN PANELİ</h1>
                <div class="date-display" id="teacher-date">28 Ağustos 2023 Pazartesi</div>
            </header>
            
            <div class="role-switch" onclick="showRoleSelection()">
                <i class="fas fa-chalkboard-teacher"></i> Öğretmen
            </div>
            
            <div class="user-info">
                <span class="user-email" id="teacher-email">ogretmen@example.com</span>
                <button class="auth-btn" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i> Çıkış
                </button>
            </div>
            
            <div class="date-filter">
                <span>Tarih Aralığı:</span>
                <input type="date" id="start-date" class="filter-input">
                <span>-</span>
                <input type="date" id="end-date" class="filter-input">
                <button class="auth-btn" onclick="loadStudentsData()">
                    <i class="fas fa-filter"></i> Filtrele
                </button>
            </div>
            
            <div class="teacher-actions">
                <button class="teacher-action-btn" onclick="exportData()">
                    <i class="fas fa-download"></i> Verileri İndir
                </button>
                <button class="teacher-action-btn" onclick="sendReminders()">
                    <i class="fas fa-bell"></i> Hatırlatma Gönder
                </button>
                <button class="teacher-action-btn" onclick="showStatistics()">
                    <i class="fas fa-chart-bar"></i> İstatistikleri Görüntüle
                </button>
            </div>
            
            <div class="stats">
                <div class="stat-box">
                    <div class="stat-value" id="total-students">0</div>
                    <div class="stat-label">Toplam Öğrenci</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="avg-questions">0</div>
                    <div class="stat-label">Ort. Soru Sayısı</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="avg-pages">0</div>
                    <div class="stat-label">Ort. Sayfa Sayısı</div>
                </div>
            </div>
            
            <div class="student-list">
                <h2><i class="fas fa-users"></i> Öğrenci Listesi</h2>
                <div id="students-container">
                    <div class="loading">
                        <i class="fas fa-spinner"></i> Öğrenci listesi yükleniyor...
                    </div>
                </div>
            </div>
            
            <div id="student-detail" class="student-detail" style="display: none;">
                <div class="detail-header">
                    <h3 id="detail-student-name">Öğrenci Detayları</h3>
                    <button class="auth-btn" onclick="hideStudentDetail()">
                        <i class="fas fa-times"></i> Kapat
                    </button>
                </div>
                
                <div class="performance-chart" id="performance-chart">
                    <!-- Grafik çubukları JavaScript ile eklenecek -->
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Türkçe</div>
                        <div class="stat-value" id="det-turkce">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Matematik</div>
                        <div class="stat-value" id="det-matematik">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Fen Bilimleri</div>
                        <div class="stat-value" id="det-fen">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">İnkılap Tarihi</div>
                        <div class="stat-value" id="det-inkilap">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Din Kültürü</div>
                        <div class="stat-value" id="det-din">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">İngilizce</div>
                        <div class="stat-value" id="det-ingilizce">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Toplam Soru</div>
                        <div class="stat-value" id="det-total">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Okunan Sayfa</div>
                        <div class="stat-value" id="det-sayfa">0</div>
                    </div>
                </div>
                
                <div class="student-details-panel">
                    <h4>Öğrenci Performans Geçmişi</h4>
                    <div id="student-history">
                        <div class="loading">
                            <i class="fas fa-spinner"></i> Geçmiş veriler yükleniyor...
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Toast Container -->
    <div id="toast-container" class="toast-container"></div>

    <div class="motivation">
        <p>"Başarı, küçük çabaların sürekliliğinden doğar." - Robert Collier</p>
    </div>

    <script>
        // Firebase yapılandırması
        const firebaseConfig = {
            apiKey: "AIzaSyDPw0wozG7ycrr7tuDqzKUM3a_sqm8Xwr0",
            authDomain: "ders-programim-2d68e.firebaseapp.com",
            projectId: "ders-programim-2d68e",
            storageBucket: "ders-programim-2d68e.firebasestorage.app",
            messagingSenderId: "658998929408",
            appId: "1:658998929408:web:92d5a6fffd728ba6f410e5",
            measurementId: "G-13JJ56NNMZ"
        };
        
        // Firebase'i başlat
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        
        // Global değişkenler
        let selectedRole = null;
        let currentUser = null;
        
        // Kullanıcı durumunu izle
        auth.onAuthStateChanged(async (user) => {
            currentUser = user;
            if (user) {
                // Kullanıcı giriş yapmış
                document.getElementById('user-container').style.display = 'flex';
                document.getElementById('user-email').textContent = user.email;
                document.getElementById('teacher-email').textContent = user.email;
                
                // Kullanıcı rolünü kontrol et
                const role = await checkUserRole(user.uid);
                
                if (role === 'student') {
                    // Öğrenci panelini göster
                    showStudentPanel();
                    // Bugünün verilerini yükle
                    loadTodaysData();
                    
                    // Geçmiş sekmesi aktifse geçmiş verileri yükle
                    if (document.getElementById('history-tab').classList.contains('active')) {
                        loadHistory();
                    }
                } else if (role === 'teacher') {
                    // Öğretmen panelini göster
                    showTeacherPanel();
                    // Öğretmen paneline öğrenci listesini yükle
                    loadStudentsList();
                } else {
                    // Rol atanmamışsa çıkış yap
                    auth.signOut();
                    showRoleSelection();
                    showToast('Kullanıcı rolü bulunamadı. Lütfen tekrar giriş yapın.', 'error');
                }
            } else {
                // Kullanıcı giriş yapmamış
                document.getElementById('user-container').style.display = 'none';
                showRoleSelection();
            }
        });
        
        // Sayfa yüklendiğinde
        document.addEventListener('DOMContentLoaded', function() {
            // Rol seçimi ekranını göster
            showRoleSelection();
            
            // Tarihi güncelle
            updateDate();
            
            // Input değişikliklerini dinle ve istatistikleri güncelle
            const inputs = document.querySelectorAll('input');
            inputs.forEach(input => {
                input.addEventListener('input', updateStats);
            });
            
            // İlk yüklemede istatistikleri güncelle
            updateStats();
        });
        
        // Tarihi güncelleme fonksiyonu
        function updateDate() {
            const now = new Date();
            const options = { day: 'numeric', month: 'long', year: 'numeric', weekday: 'long' };
            const dateString = now.toLocaleDateString('tr-TR', options);
            document.getElementById('current-date').textContent = dateString;
            document.getElementById('teacher-date').textContent = dateString;
        }
        
        // İstatistikleri güncelleme fonksiyonu
        function updateStats() {
            let totalQuestions = 0;
            
            // Ders inputlarını al
            const turkce = parseInt(document.getElementById('turkce').value) || 0;
            const matematik = parseInt(document.getElementById('matematik').value) || 0;
            const fen = parseInt(document.getElementById('fen').value) || 0;
            const inkilap = parseInt(document.getElementById('inkilap').value) || 0;
            const din = parseInt(document.getElementById('din').value) || 0;
            const ingilizce = parseInt(document.getElementById('ingilizce').value) || 0;
            
            // Toplam soru sayısını hesapla
            totalQuestions = turkce + matematik + fen + inkilap + din + ingilizce;
            
            // Sayfa sayısını al
            const totalPages = parseInt(document.getElementById('sayfa').value) || 0;
            
            // İstatistikleri güncelle
            document.getElementById('total-questions').textContent = totalQuestions;
            document.getElementById('total-pages').textContent = totalPages;
        }
        
        function selectRole(role) {
            selectedRole = role;
            document.querySelectorAll('.role-option').forEach(opt => opt.classList.remove('selected'));
            event.currentTarget.classList.add('selected');
            document.getElementById('continue-btn').disabled = false;
        }
        
        function showRoleAuth() {
            if (!selectedRole) return;
            
            // Rol seçimini gizle, giriş formunu göster
            document.querySelector('.role-options').style.display = 'none';
            document.getElementById('role-auth-container').style.display = 'block';
            document.getElementById('continue-btn').style.display = 'none';
            
            // Başlığı güncelle
            const roleTitle = selectedRole === 'student' ? 'Öğrenci' : 'Öğretmen';
            document.getElementById('role-auth-title').textContent = `${roleTitle} Girişi`;
        }
        
        function showRoleSelectionOnly() {
            // Giriş formunu gizle, rol seçimini göster
            document.querySelector('.role-options').style.display = 'flex';
            document.getElementById('role-auth-container').style.display = 'none';
            document.getElementById('continue-btn').style.display = 'block';
            
            // Formu temizle
            document.getElementById('role-email').value = '';
            document.getElementById('role-password').value = '';
            clearError('role-auth-error');
        }
        
        function showRoleSelection() {
            // Çıkış yap ve rol seçim ekranına dön
            auth.signOut().then(() => {
                document.getElementById('role-selection').style.display = 'flex';
                document.getElementById('student-panel').style.display = 'none';
                document.getElementById('teacher-panel').style.display = 'none';
                document.getElementById('role-switch').style.display = 'none';
                
                // Rol seçim ekranını sıfırla
                showRoleSelectionOnly();
                selectedRole = null;
                document.getElementById('continue-btn').disabled = true;
                document.querySelectorAll('.role-option').forEach(opt => opt.classList.remove('selected'));
                
                showToast('Çıkış yapıldı.', 'info');
            }).catch((error) => {
                showToast('Çıkış hatası: ' + (error?.message || ''), 'error');
            });
        }
        
        // Kullanıcı rolünü kontrol etme
        async function checkUserRole(uid) {
            try {
                const userDoc = await db.collection('users').doc(uid).get();
                if (userDoc.exists) {
                    return userDoc.data().role;
                }
                return null;
            } catch (error) {
                console.error("Rol kontrol hatası:", error);
                return null;
            }
        }
        
        async function roleLogin() {
            const email = document.getElementById('role-email').value;
            const password = document.getElementById('role-password').value;
            
            if (!email || !password) {
                showError('role-auth-error', 'Lütfen e-posta ve şifre girin.');
                return;
            }
            
            try {
                const userCredential = await auth.signInWithEmailAndPassword(email, password);
                clearError('role-auth-error');
                showToast('Başarıyla giriş yapıldı.', 'success');
                
                // Kullanıcı rolünü kontrol et
                const role = await checkUserRole(userCredential.user.uid);
                
                if (role === selectedRole) {
                    // Giriş başarılıysa ilgili panelyi göster
                    if (selectedRole === 'student') {
                        showStudentPanel();
                    } else if (selectedRole === 'teacher') {
                        showTeacherPanel();
                    }
                } else {
                    // Rol uyuşmazlığı varsa çıkış yap
                    auth.signOut();
                    showError('role-auth-error', 'Bu hesap ile seçtiğiniz role erişim izniniz yok.');
                    showToast('Rol uyuşmazlığı: Hesap bu role erişemez.', 'error');
                }
            } catch (error) {
                const message = getAuthErrorMessage(error.code, 'login');
                showError('role-auth-error', message);
                showToast('Giriş hatası: ' + message, 'error');
            }
        }
        
        async function roleSignup() {
            const email = document.getElementById('role-email').value;
            const password = document.getElementById('role-password').value;
            
            if (!email || !password) {
                showError('role-auth-error', 'Lütfen e-posta ve şifre girin.');
                return;
            }
            
            if (password.length < 6) {
                showError('role-auth-error', 'Şifre en az 6 karakter olmalıdır.');
                return;
            }
            
            try {
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                const user = userCredential.user;
                
                // Firestore'da kullanıcı rolünü kaydet
                await db.collection('users').doc(user.uid).set({
                    email: email,
                    role: selectedRole,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                clearError('role-auth-error');
                showToast('Hesabınız oluşturuldu. Giriş yapıldı.', 'success');
                
                // Kayıt başarılıysa ilgili panelyi göster
                if (selectedRole === 'student') {
                    showStudentPanel();
                } else if (selectedRole === 'teacher') {
                    showTeacherPanel();
                }
            } catch (error) {
                showError('role-auth-error', getAuthErrorMessage(error.code, 'signup'));
            }
        }
        
        function showStudentPanel() {
            document.getElementById('role-selection').style.display = 'none';
            document.getElementById('student-panel').style.display = 'block';
            document.getElementById('teacher-panel').style.display = 'none';
            document.getElementById('role-switch').style.display = 'block';
            document.getElementById('role-switch').innerHTML = `<i class="fas fa-user-graduate"></i> Öğrenci`;
        }
        
        function showTeacherPanel() {
            document.getElementById('role-selection').style.display = 'none';
            document.getElementById('student-panel').style.display = 'none';
            document.getElementById('teacher-panel').style.display = 'block';
            document.getElementById('role-switch').style.display = 'block';
            document.getElementById('role-switch').innerHTML = `<i class="fas fa-chalkboard-teacher"></i> Öğretmen`;
            
            // Öğretmen paneline öğrenci listesini yükle
            loadStudentsList();
        }
        
        function showError(id, message) {
            const el = document.getElementById(id);
            if (!el) return;
            el.textContent = message;
            el.style.display = 'block';
        }
        
        function clearError(id) {
            const el = document.getElementById(id);
            if (!el) return;
            el.textContent = '';
            el.style.display = 'none';
        }
        
        function showToast(message, type = 'info', duration = 3000) {
            const container = document.getElementById('toast-container');
            if (!container) return;
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            const iconClass = {
                success: 'fa-check-circle',
                error: 'fa-circle-exclamation',
                warning: 'fa-triangle-exclamation',
                info: 'fa-circle-info'
            }[type] || 'fa-circle-info';
            toast.innerHTML = `<i class="fa-solid ${iconClass} toast-icon"></i><span class="toast-text">${message}</span>`;
            container.appendChild(toast);
            // trigger animation
            requestAnimationFrame(() => toast.classList.add('show'));
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 250);
            }, duration);
        }
        
        function getAuthErrorMessage(code, context) {
            const isLogin = context === 'login';
            const map = {
                'auth/invalid-email': 'Geçersiz e-posta adresi.',
                'auth/user-disabled': 'Bu hesap devre dışı bırakılmış.',
                'auth/user-not-found': isLogin ? 'Bu e-posta ile kayıtlı kullanıcı bulunamadı.' : 'Kullanıcı bulunamadı.',
                'auth/wrong-password': 'Şifre hatalı.',
                'auth/invalid-credential': 'Şifre hatalı.',
                'auth/too-many-requests': 'Çok fazla deneme yapıldı. Lütfen daha sonra tekrar deneyin.',
                'auth/network-request-failed': 'Ağ hatası. İnternet bağlantınızı kontrol edin.',
                'auth/email-already-in-use': 'Bu e-posta zaten kullanımda.',
                'auth/weak-password': 'Şifre çok zayıf. En az 6 karakter olmalıdır.'
            };
            return map[code] || 'Bir hata oluştu. Lütfen tekrar deneyin.';
        }
        
        // Çıkış yapma fonksiyonu
        function logout() {
            auth.signOut().then(() => {
                showRoleSelection();
            }).catch((error) => {
                showToast('Çıkış hatası: ' + (error?.message || ''), 'error');
            });
        }
        
        // Bugünün verilerini yükleme fonksiyonu
        function loadTodaysData() {
            const user = auth.currentUser;
            if (!user) return;
            
            const now = new Date();
            const dateKey = now.toISOString().split('T')[0]; // YYYY-MM-DD formatında tarih
            
            db.collection("users").doc(user.uid).collection("days").doc(dateKey)
                .get()
                .then((doc) => {
                    if (doc.exists) {
                        // Bugünün verileri zaten kaydedilmiş, inputları doldur
                        const data = doc.data();
                        document.getElementById('turkce').value = data.turkce || 0;
                        document.getElementById('matematik').value = data.matematik || 0;
                        document.getElementById('fen').value = data.fen || 0;
                        document.getElementById('inkilap').value = data.inkilap || 0;
                        document.getElementById('din').value = data.din || 0;
                        document.getElementById('ingilizce').value = data.ingilizce || 0;
                        document.getElementById('sayfa').value = data.sayfa || 0;
                        
                        // Inputları disable yap
                        const inputs = document.querySelectorAll('input');
                        inputs.forEach(input => {
                            input.disabled = true;
                        });
                        
                        document.getElementById('save-btn').disabled = true;
                        document.getElementById('save-btn').innerHTML = '<i class="fas fa-check"></i> Bugün Kaydedildi';
                        
                        // İstatistikleri güncelle
                        updateStats();
                    }
                })
                .catch((error) => {
                    console.log("Veri yükleme hatası:", error);
                });
        }
        
        // Günlük verileri kaydetme fonksiyonu
        function saveDailyData() {
            const user = auth.currentUser;
            if (!user) {
                showToast('Lütfen önce giriş yapın!', 'warning');
                return;
            }
            
            const now = new Date();
            const dateKey = now.toISOString().split('T')[0]; // YYYY-MM-DD formatında tarih
            
            // Bugünün verilerini al
            const dailyData = {
                date: now.toLocaleDateString('tr-TR'),
                turkce: parseInt(document.getElementById('turkce').value) || 0,
                matematik: parseInt(document.getElementById('matematik').value) || 0,
                fen: parseInt(document.getElementById('fen').value) || 0,
                inkilap: parseInt(document.getElementById('inkilap').value) || 0,
                din: parseInt(document.getElementById('din').value) || 0,
                ingilizce: parseInt(document.getElementById('ingilizce').value) || 0,
                sayfa: parseInt(document.getElementById('sayfa').value) || 0,
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            };
            
            // Toplam soru sayısını hesapla
            dailyData.total = dailyData.turkce + dailyData.matematik + dailyData.fen + 
                             dailyData.inkilap + dailyData.din + dailyData.ingilizce;
            
            // Firestore'a kaydet
            db.collection("users").doc(user.uid).collection("days").doc(dateKey)
                .set(dailyData)
                .then(() => {
                    showToast('Bugünkü verileriniz kaydedildi!', 'success');
                    
                    // Inputları disable yap
                    const inputs = document.querySelectorAll('input');
                    inputs.forEach(input => {
                        input.disabled = true;
                    });
                    
                    document.getElementById('save-btn').disabled = true;
                    document.getElementById('save-btn').innerHTML = '<i class="fas fa-check"></i> Bugün Kaydedildi';
                    
                    // Kullanıcı istatistiklerini güncelle
                    updateUserStats(user.uid, dailyData);
                })
                .catch((error) => {
                    showToast("Kayıt hatası: " + error.message, 'error');
                });
        }
        
        // Kullanıcı istatistiklerini güncelleme
        async function updateUserStats(uid, dailyData) {
            try {
                const statsRef = db.collection('userStats').doc(uid);
                const statsDoc = await statsRef.get();
                
                if (statsDoc.exists) {
                    // Mevcut istatistikleri güncelle
                    const currentStats = statsDoc.data();
                    await statsRef.update({
                        turkce: (currentStats.turkce || 0) + dailyData.turkce,
                        matematik: (currentStats.matematik || 0) + dailyData.matematik,
                        fen: (currentStats.fen || 0) + dailyData.fen,
                        inkilap: (currentStats.inkilap || 0) + dailyData.inkilap,
                        din: (currentStats.din || 0) + dailyData.din,
                        ingilizce: (currentStats.ingilizce || 0) + dailyData.ingilizce,
                        total: (currentStats.total || 0) + dailyData.total,
                        sayfa: (currentStats.sayfa || 0) + dailyData.sayfa,
                        lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
                    });
                } else {
                    // Yeni istatistikler oluştur
                    await statsRef.set({
                        turkce: dailyData.turkce,
                        matematik: dailyData.matematik,
                        fen: dailyData.fen,
                        inkilap: dailyData.inkilap,
                        din: dailyData.din,
                        ingilizce: dailyData.ingilizce,
                        total: dailyData.total,
                        sayfa: dailyData.sayfa,
                        lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
                    });
                }
            } catch (error) {
                console.error("İstatistik güncelleme hatası:", error);
            }
        }
        
        // Geçmiş kayıtları yükleme fonksiyonu
        function loadHistory() {
            const user = auth.currentUser;
            if (!user) {
                document.getElementById('history-list').innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-exclamation-circle"></i>
                        <p>Geçmiş verileri görüntülemek için giriş yapmalısınız</p>
                    </div>
                `;
                return;
            }
            
            document.getElementById('history-list').innerHTML = `
                <div class="loading">
                    <i class="fas fa-spinner"></i> Yükleniyor...
                </div>
            `;
            
            db.collection("users").doc(user.uid).collection("days")
                .orderBy("timestamp", "desc")
                .limit(10)
                .get()
                .then((querySnapshot) => {
                    if (querySnapshot.empty) {
                        document.getElementById('history-list').innerHTML = `
                            <div class="empty-state">
                                <i class="fas fa-clipboard-list"></i>
                                <p>Henüz kayıtlı veri bulunmamaktadır</p>
                            </div>
                        `;
                        return;
                    }
                    
                    let historyHTML = '';
                    querySnapshot.forEach((doc) => {
                        const data = doc.data();
                        historyHTML += `
                            <div class="history-item">
                                <div class="history-date">${data.date}</div>
                                <div class="history-stats">${data.total} soru, ${data.sayfa} sayfa</div>
                            </div>
                        `;
                    });
                    
                    document.getElementById('history-list').innerHTML = historyHTML;
                })
                .catch((error) => {
                    document.getElementById('history-list').innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-exclamation-triangle"></i>
                            <p>Veriler yüklenirken hata oluştu</p>
                        </div>
                    `;
                    console.log("Geçmiş yükleme hatası:", error);
                });
        }
        
        // Öğretmen paneli işlevleri
        async function loadStudentsList() {
            // Öğrenci listesini yükle
            const user = auth.currentUser;
            if (!user) return;
            
            try {
                // Tüm öğrencileri getir
                const studentsSnapshot = await db.collection('users')
                    .where('role', '==', 'student')
                    .get();
                
                if (studentsSnapshot.empty) {
                    document.getElementById('students-container').innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-user-graduate"></i>
                            <p>Henüz öğrenciniz bulunmamaktadır</p>
                        </div>
                    `;
                    return;
                }
                
                let studentsHTML = '';
                let totalQuestions = 0;
                let totalPages = 0;
                
                for (const doc of studentsSnapshot.docs) {
                    const student = doc.data();
                    const studentId = doc.id;
                    
                    // Öğrenci istatistiklerini getir
                    let studentQuestions = 0;
                    let studentPages = 0;
                    
                    try {
                        const statsDoc = await db.collection('userStats').doc(studentId).get();
                        if (statsDoc.exists) {
                            const stats = statsDoc.data();
                            studentQuestions = stats.total || 0;
                            studentPages = stats.sayfa || 0;
                        }
                    } catch (error) {
                        console.error("Öğrenci istatistikleri yüklenirken hata:", error);
                    }
                    
                    studentsHTML += `
                        <div class="student-item" onclick="showStudentDetail('${studentId}')">
                            <div class="student-name">${student.name || student.email}</div>
                            <div class="student-stats">
                                <span>${studentQuestions} soru</span>
                                <span>${studentPages} sayfa</span>
                            </div>
                        </div>
                    `;
                    
                    totalQuestions += studentQuestions;
                    totalPages += studentPages;
                }
                
                document.getElementById('students-container').innerHTML = studentsHTML;
                document.getElementById('total-students').textContent = studentsSnapshot.size;
                
                // Ortalama hesaplamaları
                const avgQuestions = studentsSnapshot.size > 0 ? Math.round(totalQuestions / studentsSnapshot.size) : 0;
                const avgPages = studentsSnapshot.size > 0 ? Math.round(totalPages / studentsSnapshot.size) : 0;
                
                document.getElementById('avg-questions').textContent = avgQuestions;
                document.getElementById('avg-pages').textContent = avgPages;
                
            } catch (error) {
                console.log("Öğrenci listesi yüklenirken hata oluştu:", error);
                document.getElementById('students-container').innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-exclamation-triangle"></i>
                        <p>Öğrenci listesi yüklenirken hata oluştu</p>
                    </div>
                `;
            }
        }
        
        async function showStudentDetail(studentId) {
            // Öğrenci detaylarını göster
            document.getElementById('student-detail').style.display = 'block';
            
            try {
                // Öğrenci bilgilerini getir
                const studentDoc = await db.collection('users').doc(studentId).get();
                if (!studentDoc.exists) {
                    showToast('Öğrenci bulunamadı.', 'error');
                    return;
                }
                
                const student = studentDoc.data();
                const studentName = student.name || student.email;
                
                document.getElementById('detail-student-name').textContent = `${studentName} - Detaylı İstatistikler`;
                
                // Öğrenci istatistiklerini getir
                const statsDoc = await db.collection('userStats').doc(studentId).get();
                if (statsDoc.exists) {
                    const stats = statsDoc.data();
                    
                    document.getElementById('det-turkce').textContent = stats.turkce || 0;
                    document.getElementById('det-matematik').textContent = stats.matematik || 0;
                    document.getElementById('det-fen').textContent = stats.fen || 0;
                    document.getElementById('det-inkilap').textContent = stats.inkilap || 0;
                    document.getElementById('det-din').textContent = stats.din || 0;
                    document.getElementById('det-ingilizce').textContent = stats.ingilizce || 0;
                    document.getElementById('det-total').textContent = stats.total || 0;
                    document.getElementById('det-sayfa').textContent = stats.sayfa || 0;
                    
                    // Performans grafiğini oluştur
                    createPerformanceChart(stats);
                } else {
                    // İstatistikler yoksa sıfırları göster
                    document.getElementById('det-turkce').textContent = 0;
                    document.getElementById('det-matematik').textContent = 0;
                    document.getElementById('det-fen').textContent = 0;
                    document.getElementById('det-inkilap').textContent = 0;
                    document.getElementById('det-din').textContent = 0;
                    document.getElementById('det-ingilizce').textContent = 0;
                    document.getElementById('det-total').textContent = 0;
                    document.getElementById('det-sayfa').textContent = 0;
                    
                    // Boş grafik oluştur
                    createPerformanceChart({});
                }
                
                // Öğrenci geçmiş verilerini getir
                const historySnapshot = await db.collection('users').doc(studentId)
                    .collection('days')
                    .orderBy('timestamp', 'desc')
                    .limit(7)
                    .get();
                
                let historyHTML = '';
                if (historySnapshot.empty) {
                    historyHTML = '<p>Henüz kayıtlı veri bulunmamaktadır</p>';
                } else {
                    historyHTML = '<div class="history-list">';
                    historySnapshot.forEach(doc => {
                        const data = doc.data();
                        historyHTML += `
                            <div class="history-item">
                                <div class="history-date">${data.date}</div>
                                <div class="history-stats">${data.total || 0} soru, ${data.sayfa || 0} sayfa</div>
                            </div>
                        `;
                    });
                    historyHTML += '</div>';
                }
                
                document.getElementById('student-history').innerHTML = historyHTML;
                
            } catch (error) {
                console.error("Öğrenci detayları yüklenirken hata oluştu:", error);
                showToast('Öğrenci detayları yüklenirken hata oluştu', 'error');
            }
        }
        
        function createPerformanceChart(stats) {
            const chartContainer = document.getElementById('performance-chart');
            chartContainer.innerHTML = '';
            
            const subjects = [
                { id: 'turkce', label: 'Türkçe', value: stats.turkce || 0 },
                { id: 'matematik', label: 'Matematik', value: stats.matematik || 0 },
                { id: 'fen', label: 'Fen', value: stats.fen || 0 },
                { id: 'inkilap', label: 'İnkılap', value: stats.inkilap || 0 },
                { id: 'din', label: 'Din', value: stats.din || 0 },
                { id: 'ingilizce', label: 'İngilizce', value: stats.ingilizce || 0 }
            ];
            
            // En yüksek değeri bul (minimum 10 olsun)
            const maxValue = Math.max(...subjects.map(s => s.value), 10);
            
            subjects.forEach(subject => {
                const barHeight = subject.value > 0 ? (subject.value / maxValue) * 150 : 5;
                const bar = document.createElement('div');
                bar.className = 'chart-bar';
                bar.style.height = `${barHeight}px`;
                bar.innerHTML = `
                    <div class="chart-bar-value">${subject.value}</div>
                    <div class="chart-bar-label">${subject.label}</div>
                `;
                chartContainer.appendChild(bar);
            });
        }
        
        function hideStudentDetail() {
            document.getElementById('student-detail').style.display = 'none';
        }
        
        function loadStudentsData() {
            // Filtreleme yapılmış öğrenci verilerini yükle
            const startDate = document.getElementById('start-date').value;
            const endDate = document.getElementById('end-date').value;
            
            if (startDate && endDate) {
                showToast(`${startDate} - ${endDate} tarih aralığı için filtreleme yapıldı`, 'info');
                // Burada filtreleme işlemleri yapılacak
                // Şimdilik tüm listeyi yeniden yüklüyoruz
                loadStudentsList();
            } else {
                showToast('Tüm öğrenci verileri yüklendi', 'info');
                loadStudentsList();
            }
        }
        
        function exportData() {
            showToast('Veri indirme işlemi başlatıldı', 'info');
            // Burada veri indirme işlemleri yapılacak
        }
        
        function sendReminders() {
            showToast('Hatırlatma mesajları gönderildi', 'success');
            // Burada hatırlatma gönderme işlemleri yapılacak
        }
        
        function showStatistics() {
            showToast('İstatistikler görüntüleniyor', 'info');
            // Burada istatistik görüntüleme işlemleri yapılacak
        }
        
        // Yazdırma fonksiyonu
        function printData() {
            window.print();
        }
        
        // Tab gösterimini değiştirme
        function showTab(tabName) {
            // Tüm tab içeriklerini gizle
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Tüm tab başlıklarını pasif yap
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // İlgili tab içeriğini göster
            document.getElementById(tabName + '-tab').classList.add('active');
            
            // İlgili tab başlığını aktif yap
            document.querySelectorAll('.tab').forEach(tab => {
                if (tab.textContent === (tabName === 'today' ? 'Bugün' : 'Geçmiş')) {
                    tab.classList.add('active');
                }
            });
            
            // Geçmiş sekmesi seçilirse geçmişi güncelle
            if (tabName === 'history') {
                loadHistory();
            }
        }
    </script>
</body>
</html>